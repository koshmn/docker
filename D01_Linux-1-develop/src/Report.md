# UNIX/Linux operating systems (Basic) by Almaveno.

Установка и обновления системы Linux. Основы администрирования.

## Contents

## Part 1. Установка ОС

* Скачиваем образ **Ubuntu 20.04 server LTS** 
* Ставим образ на **VirtualBox**
* Результат выполненого запроса `cat /etc/issue` внутри получившейся виртуальной машины
   ![Версия Ubuntu](screen/start.png)<br>*Версия Ubuntu*<br>

<br>

## Part 2. Создание пользователя

* Выполняем команды `sudo adduser new_user` для создания нового юзера
![Создание нового юзера](screen/1.png)<br>*Создание нового юзера*<br>
* Выполняем команды `sudo usermod -aG adm new_user` для добавления его в группу `adm`
![Добавление юзера в группу](screen/adm.png)<br>*Добавление юзера в группу*<br>
* Для проверки успеха выполнения задания выполняем `vim /etc/group`, что позволит посмотреть появился ли новый пользователь в группе `adm` <br>
![Группа adm](screen/3.png)<br>*Группа adm*<br>
* Новый пользователь должен быть в выводе команды `cat /etc/passwd`
![passwd](screen/4.png)<br>*passwd*<br>

<br>

## Part 3. Настройка сети ОС

* Выполняем команду `sudo hostnamectl set-hostname user-1`

* Далее `cat /etc/hostname` - проверка результата

![Результат смены имени машины](screen/5.png)<br>*Результат смены имени машины*<br>

<br>

**== Задание 2 ==**

##### Установливаем временную зону в текущем времени.

* Выполняем команду `sudo timedatectl set-timezone Europe/Moscow`

* Проверяем результат, выполнив `timedatectl`

![Результат установки системного времени](screen/6.png)<br>*Результат установки системного времени*<br>

<br>

**== Задание 3 ==**

##### Выведем названия сетевых интерфейсов с помощью консольной команды.
* **lo (loopback device)** – виртуальный интерфейс, присутствующий по умолчанию в любом Linux. Посмотреть привязку можно в файле /etc/hosts.

* Выполняем команду `ls /sys/class/net` для отображения сетевых интерфейсов

![Результат выполнения команды](screen/7.png)<br>*Результат выполнения команды*<br>

<br>

**== Задание 4 ==**

##### Получаем ip адрес устройства от DHCP сервера. 

* **DHCP** — протокол прикладного уровня модели TCP/IP, служит для назначения IP-адреса клиенту. Это следует из его названия — Dynamic Host Configuration Protocol. 

* Выполняем команду `ip r` для получения ip-адреса от DHCP сервера

![Результат выполнения команды](screen/8.png)<br>*Результат выполнения команды*<br>


<br>

**== Задание 5 ==**

##### В этом пункте oпределяем и выводим на экран внешний ip-адрес шлюза (ip) и внутренний IP-адрес шлюза, он же ip-адрес по умолчанию (gw). 

* Выполняем команду `wget -qO- eth0.me` для вывода внешнего ip шлюза, и `ip route | grep default` для вывода внутреннего

![Внешний ip-адрес шлюза (ip) и внутренний IP-адрес шлюза](screen/9.png)<br>*Внешний ip-адрес шлюза (ip) и внутренний IP-адрес шлюза*<br>

<br>

**== Задание 6 ==**

##### Задаем статичные настройки ip, gw, dns.  

* Меняем доступ к файлу для дальнейшего его редактирования `sudo chmod 777 /etc/netplan/00-installer-config.yaml`

* Редактируем файл под нужные настройки используя `vim /etc/netplan/00-installer-config.yaml` 

![Итоговые параметры в файле](screen/10.png)<br>*Итоговые параметры в файле*<br>

* Сохраняем изменения командой `sudo netplan apply`

<br>

**== Задание 7 ==**

* Перезапускаем машину командой `reboot`
* Пингуем командой `hostname -I && ping -c 4 1.1.1.1 | grep "stat\|loss" && ping -c 4 ya.ru`

![Вывод команды](screen/11.png)<br>*Вывод команды*<br>

<br>

## Part 4. Обновление ОС

##### Обновляем системные пакеты до последней на момент выполнения задания версии.  

* Выполняем команду `sudo apt update` для получения доступных пакетов

* Обновляем системные пакеты до последней версии командой `sudo apt full-upgrade`

* Запускаем команду обновления ещё раз

![Результат повторного запуска обновления](screen/12.png)<br>*Результат повторного запуска обновления*<br>

<br>

## Part 5. Использование команды **sudo**

##### Разрешаем созданному пользователю, созданному в [Part 2](#part-2-создание-пользователя), выполнять команду sudo.


* Sudo (su «do») позволяет системному администратору делегировать полномочия, чтобы дать определенным пользователям  возможность запускать некоторые (или все) команды от имени пользователя root или другого пользователя, обеспечивая контрольный журнал команд и их аргументов.

* Командой `sudo usermod -a -G sudo new_user` разрешаем пользователю использовать sudo

* Командой `su - new_user` меняем пользователя

* Меняем hostname под другим пользователем `sudo hostnamectl set-hostname user-2` 

* `cat /etc/hostname` смотрим результат

![Результат выполнения команд](screen/13.png)<br>*Результат выполнения команд*<br>

<br>

## Part 6. Установка и настройка службы времени

##### Настроиваем службу автоматической синхронизации времени.  

* Проверяем время которое установлено в данный момент командой `date`

![Установленое сейчас время](screen/14.png)<br>*Установленое сейчас время*<br>

* Установка NTP командой `sudo apt install systemd-timesyncd`

* Активируем NTP командой `sudo timedatectl set-ntp on`

* Вывод команды `timedatectl show`

![Результат работы команды](screen/15.png)<br>*Результат работы команды*<br>

<br>

## Part 7. Установка и использование текстовых редакторов 

##### Установавливаем текстовые редакторы **VIM**, **NANO**, **mcedit**.  

* Используя команду `sudo apt install mcedit` устанавливаем текстовый редактор mcedit

<br>

##### Создаем файл *test_X.txt*.

**VIM** 

* Создаем файл с помощью команды `vim test_vim.txt`

* Нажимаем "i" для перехода в режим редактирования

* Пишем ник: "almaveno"

Для выхода с сохранением нажимем `Esc` вводим команду `:wq` и нажимаем `Enter`

![VIM](screen/16.png)<br>*VIM*<br>

<br>

**NANO**

* Создаем файл с помощью команды `nano test_nano.txt`

* Пишем ник: "almaveno"

* Для выхода нажимаем комбинацию `ctrl+x` для сохранения вводим `Y` и нажимаем`Enter`

![NANO](screen/17.png)<br>*NANO*<br>

<br>

**MCEDIT**

* Cоздаем файл с помощью команды `mcedit test_mcedit.txt`

* Пишем ник: "almaveno"

* Для выхода с сохранением нажимаем `Esc`, а затем клавишу `YES`

![mcedit](screen/18.png)<br>*mcedit*<br>

**== Задание 3 ==**

##### Открываем файл на редактирование и заменяем никнейм на строку "21 School 21".

**VIM**

* Открываем файл с помощью команды `vim test_vim.txt`

* Нажимаем "i" для перехода в режим редактирования

* Изменяем ник на "21 School 21"

* Для выхода без сохранения нажимаем `Esc` вводим команду `:q!` и нажимаем `Enter`

![VIM](screen/19.png)<br>*VIM*<br>

**NANO**

* Открываем файл с помощью команды `nano test_nano.txt`

* Изменяем ник на "21 School 21"

* Для выхода без сохранения нажимаем комбинацию `ctrl+x`, потом `N`

![NANO](screen/20.png)<br>*NANO*<br>

**MCEDIT**

* Открываем файл с помощью команды `mcedit test_mcedit.txt`.

* Изменяем ник на "21 School 21"

* Для выхода без сохранения нажимаем `Esc`, а затем `No`

![mcedit](screen/21.png)<br>*mcedit*<br>

<br>

**== Задание 4 ==**

##### Используем функции поиска по содержимому файла и замены слов. 

**VIM**

* Открываем файл с помощью команды `vim test_vim.txt`

* Для поиска в VIM вводим `/marinezdes` и искомое слово выделяется в самом редакторе

![VIM](screen/22.png)<br>*VIM*<br>

* Для замены слова в VIM вводим `:%s/marinezdes/21 School 21` и слово "almaveno" заменяется на "21 School 21"

![VIM](screen/vim.png)<br>*VIM*<br>

<br>

**NANO**

* Открываем файл с помощью команды `nano test_nano.txt`

* Для поиска в NANO вводим `ctrl + W`

![NANO](screen/nano1.png)<br>*NANO*<br>

* Для замены слова в NANO вводим `ctrl + \`, пишем "almaveno", нажимаем `Enter`, пишем "21 School 21", нажимаем `Enter`, выбираем `Y`

![NANO](screen/nano2.png)<br>*NANO*<br>

<br>

**MCEDIT**

* Открываем файл с помощью команды `mcedit test_mcedit.txt`

* Для поиска в mcedit вводим `F7`, затем вводим слово, которое хотим найти, оно выделяется зеленым

![mcedit](screen/23.png)<br>*mcedit*<br>

* Для замены слова в mcedit жмем `F4`, затем вводим "almaveno", нажимаем стрелку вниз, пишем "21 School 21"

![mcedit](screen/24.png)<br>*mcedit*<br>

<br>

## Part 8. Установка и базовая настройка сервиса **SSHD**


* Устанавливаем службу SSHd командой `sudo apt install openssh-server`

* Проверяем наличие командой `ssh -V`

![Служба SSHd](screen/31.png)<br>*Служба SSHd*<br>

* Добавляем автостарт службы SSHd командой `sudo update-rc.d ssh defaults`

* Открываем config `sudo vim /etc/ssh/sshd_config`

* Изменяем порт SSHd: добавляем строку `Port 2022`

![Изменёный config](screen/32.png)<br>*Изменёный config*<br>

* Используем команду `/etc/init.d/ssh restart` для того что бы изменения вступили в силу

![Вывод команды](screen/33.png)<br>*Вывод команды*<br>

Используем команду `ps -axfv | grep sshd` для проверки наличия процесса

![SSHd процесс](screen/34.png)<br>*SSHd процесс*<br>

* Команда `ps` показывает текущие процессы на сервере. 

* Команда `grep` позволяет выдилить нужную нам информацию по процессам

* флаг -a оставляет все процессы, кроме лидеров сеансов и процессов, не связанных с терминалом

* флаг -x заставляет `ps` отображать список всех процессов, которыми вы владеете

* флаг -f выводит полноформатный список

* флаг -v выводит информацию о версии

<br>

* Устанавливаем *net-tools* `sudo apt install net-tools`

* Выполняем команду `netstat -tan`

![Выполнение команды netstat -tan](screen/35.png)<br>*Выполнение команды netstat -tan*<br>

* Опция -a показывает состояние всех сокетов

* -n показывает ip адрес, а не сетевое имя

* -t показывает только tcp соединения

* стобец Proto - протокол, используемый сокетом

* стобец Recv-Q - количество байтов, не скопированных пользовательской программой, подключенной к этому сокету

* стобец Local Adbress - локальный адрес (имя локального хоста) и номер порта сокета

* стобец Foreign Adbress - удаленный адрес (имя удаленного хоста) и номер порта сокета

* стобец State - состояние сокета

* 0.0.0.0 в выводе netstat означает, что ssh daemon прослушивает все интерфейсы IPv4, которые есть у машины

* Перезагружаем систему командой `sudo reboot`

<br>

## Part 9. Установка и использование утилит **top**, **htop**

* Командой `top` запускаем соответствующую утилиту

![Запуск top](screen/34.png)<br>*Запуск top*<br>

* uptime <br>
![uptime](screen/35.png)<br>

* количество авторизированных пользователей <br>
![kap](screen/36.png)<br>

* общая загрузка системы <br>
![ozs](screen/37.png)<br>

* общее количество процессов <br>
![okp](screen/38.png)<br>

* загрузка cpu <br>
![cpu](screen/39.png)<br>

* загрузка памяти <br>
![mem](screen/40.png)<br>

* pid процесса, занимающего больше всего памяти <br>
![pm](screen/41.png)<br>

* pid процесса, занимающего больше всего процессорного времени <br>
![pt](screen/42.png)<br>

* Жмем `q` для выхода из top

<br>

*  командой `htop` запускаем утилиту

![Запуск htop](screen/43.png)<br>*Запуск htop*<br>

* Для выбора того как проводить сортировку мы нажимаем `F6`

* PID <br>
![PID](screen/44.png)<br>*PID*<br>

* PERCENT_CPU <br>
![PERCENT_CPU](screen/45.png)<br>*PERCENT_CPU*<br>
 
* PERCENT_MEM <br>
![PERCENT_MEM](screen/46.png)<br>*PERCENT_MEM*<br>

* TIME <br>
![TIME](screen/47.png)<br>*TIME*<br>

* Для работы с фильтром нажимаем `F4`

* После мы вводим `SShd` и нажимаем `Enter`

* фильтр по SSHd <br>
![SSHd](screen/48.png)<br>*SSHd*<br>

* Для работы с поиском нажимаем `F3`

* После мы вводим `syslog` и нажимаем `Enter`

* Результат поиска <br>
![Поиск syslog](screen/49.png)<br>*Поиск syslog*<br>

* Выход `F10`

<br>

## Part 10. Использование утилиты **fdisk**

* Запуск утилиты командой `sudo fdisk -l`

![Вывод команды](screen/50.png)<br>*Вывод команды*<br>

* Название жесткого диска VBOX HARDDISK <br> 
![Название жесткого диска](screen/51.png)

* Размер <br>
![Размер](screen/52.png)

* Количество секторов <br>
![Количество секторов](screen/53.png)

* Используем команду `free -h` для определения размера swap: <br>
![Размер swap ](screen/54.png)

<br>

## Part 11. Использование утилиты **df** 

**== Задание 1 ==**

* используем команду `df /` <br>
![Вывод команды](screen/55.png)<br>*Вывод команды*<br>
    
* Размер раздела <br>
![Размер раздела](screen/56.png)

* Размер занятого пространства <br>
![Размер занятого пространства](screen/57.png)

* Размер свободного пространства <br>
![Размер свободного пространств](screen/58.png)

* Процент использования <br>
![Процент использования](screen/59.png)

* Единица измерения в выводе: Кб

**== Задание 2 ==**

##### Запускаем команду df -Th.

* используем команду `df -Th /` <br>
![Вывод команды](screen/60.png)<br>*Вывод команды*<br>

* Размер раздела <br>
![Размер раздела](screen/61.png)

* Размер занятого пространства <br>
![Размер занятого пространства](screen/62.png)

* Размер свободного пространства <br>
![Размер свободного пространства](screen/63.png)

* Процент использования <br>
![Процент использования](screen/64.png)

* Тип файловой системы для раздела <br>
![Тип файловой системы для раздела](screen/65.png)

## Part 12. Использование утилиты **du**

* Запуcк команды `du` <br>
![Вывод команды du](screen/66.png)<br>*Вывод команды*<br>

* С помощью команды `sudo du -s -h /home && sudo du -s -h /var && sudo du -s -h /var/log` выводим размер папок <br>
![Размер папок](screen/67.png)<br>*Размер папок*<br>
    
* Вывести размер элементов `/var/log` с помощью команды `sudo du -sh /var/log*` <br>
![Размер элементов](screen/68.png)<br>*Размер элементов*<br>

<br>

## Part 13. Установка и использование утилиты **ncdu**

* Командой `sudo apt install ncdu` устанавливаем ncdu

* Вывести размер папок с помощью команды `sudo ncdu` /home, /var, /var/log

![/home](screen/69.png)<br>*/home*<br>

![/var](screen/70.png)<br>*/var*<br>

![/var/log](screen/71.png)<br>*/var/log*<br>

<br>

## Part 14. Работа с системными журналами

* Просмотр `vim /var/log/dmesg` <br>
![sudo /var/log/dmesg](screen/72.png)

* Просмотр `vim /var/log/syslog` <br>
![ /var/log/syslog](screen/73.png)

* Просмотр `vim /var/log/auth.log` <br>
![ /var/log/auth.log](screen/74.png)
    
* Для просмотра последней авторизации, имени пользователя и метода входа в систему используем команду `last` <br>
![Результат работы команды](screen/75.png)<br>*Результат работы команды*<br>

* Время авторизации Aug 17 19:18
* Имя пользователя almaveno
* Метод входа в систему tty1

* Командой `service sshd restart` перезапускаем службу SSHd

![Результат работы команды](screen/76.png)<br>*Результат работы команды*<br>

* Командой `sudo cat /var/log/syslog` выводим сообщение о рестарте служб
![Результат работы команды](screen/77.png)<br>*Результат работы команды*<br>

<br>

## Part 15. Использование планировщика заданий **CRON**

- Найти в системных журналах строчки (минимум две в заданном временном диапазоне) о выполнении.
- Вывести на экран список текущих заданий для CRON.
- Вставить в отчёт скрины со строчками о выполнении и списком текущих задач.

##### Удаляеем все задания из планировщика заданий.

* Используем команду `sudo apt install cron` для установки **CRON**

* Планируем задачу командой `crontab -e`

* В vim приписываем `"*/2 * * * * uptime"`

![uptime](screen/78.png)<br>*uptime*<br>


* Командой `sudo grep CRON /var/log/syslog` выводим системных задач

![Системный журнал](screen/80.png)<br>*Системный журнал*<br>

* Командой `crontab -l` удаляем все запланированые задачи

* Проверяем список задач ещё раз

![Системный журнал](screen/81.png)<br>*Системный журнал*<br>

<br>
